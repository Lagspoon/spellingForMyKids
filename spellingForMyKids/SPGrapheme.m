//
//  SPGrapheme.m
//  spellingForMyKids
//
//  Created by Olivier Delecueillerie on 30/05/2014.
//  Copyright (c) 2014 Olivier Delecueillerie. All rights reserved.
//

#import "SPGrapheme.h"
#import "Grapheme.h"
#import "SPWordList.h"
#import "Word.h"

@interface SPGrapheme ()

@property (weak, nonatomic) IBOutlet UITextField *textFieldLetters;

@property (weak, nonatomic) IBOutlet UIView *viewContainerWordList;
@property (strong, nonatomic) Grapheme *graphemeSelected;
@property (strong, nonatomic) SPWordList *SPWordListVC;


@end

@implementation SPGrapheme

@synthesize objectList=_objectList;
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
//Lazy Instantiation & Accessors
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////

- (Grapheme *) graphemeSelected {
    if (!_graphemeSelected) _graphemeSelected = (Grapheme *) self.objectSelected;
    return _graphemeSelected;
}

- (void) setEditing:(BOOL)editing {
    [super setEditing:editing];
    
    [self updateHiddenViewWhenEditing:editing];
    
}


- (NSSet *) objectList {
    return self.graphemeSelected.words;
}


- (NSString *) key {
    return @"name";
}

//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
//VC Lifecycle
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
- (void)viewDidLoad
{
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    self.allowsMultipleSelection = YES;
    
    
    
    /////////////////////////////////////////////////////////
    //load VC for container
    /////////////////////////////////////////////////////////
    self.objectListVC = [self addObjectListIdentifier:@"words" toView:self.viewContainerWordList];

    /////////////////////////////////////////////////////////
    //update UI elements
    /////////////////////////////////////////////////////////
    self.textFieldLetters.text = self.graphemeSelected.letters;
    
}


//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
// Triggered VC
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
- (void) updateHiddenViewWhenEditing:(BOOL) editing {
    
}


//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
// Text Field Delegate
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////

- (void) textFieldDidEndEditing:(UITextField *)textField {
    self.graphemeSelected.letters = textField.text;
    self.predicate = [NSPredicate predicateWithFormat: @"%K contains[cd] '%@'",@"name",self.graphemeSelected.letters];
}

//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
// Overridding
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
- (void) buttonSaveAction {
    [self textFieldDidEndEditing:self.textFieldLetters];
    self.graphemeSelected.words = [self updatedRelationshipIn:self.objectListVC];
    
    [super buttonSaveAction];
    
}
@end
